{"version":3,"sources":["../../../src/http/_errors/index.ts","../../../src/http/_errors/bad-request-error.ts","../../../src/http/_errors/unauthorized-error.ts"],"sourcesContent":["import { AxiosError } from 'axios'\nimport type { FastifyInstance } from 'fastify'\nimport { ZodError } from 'zod'\nimport { BadRequestError } from './bad-request-error'\nimport { UnauthorizedError } from './unauthorized-error'\n\ntype FastifyErrorHandler = FastifyInstance['errorHandler']\n\nexport const errorHandler: FastifyErrorHandler = (error, request, reply) => {\n  if (error.validation) {\n    return reply.status(400).send({\n      message: ' Houve um erro na validação, verifique os dados enviados.',\n    })\n  }\n\n  if (error instanceof ZodError) {\n    return reply.status(400).send({\n      message: 'Houve um erro na validação, verifique os dados enviados.',\n      errors: error.flatten().fieldErrors,\n    })\n  }\n\n  if (error instanceof BadRequestError) {\n    return reply.status(400).send({\n      message: error.message,\n    })\n  }\n\n  if (error instanceof UnauthorizedError) {\n    return reply.status(401).send({\n      message: error.message,\n    })\n  }\n\n  // TODO: Adicionar funcionalidade do RateLimit.\n  if (error.statusCode === 429) {\n    return reply.status(429).send({\n      message: 'Limite de requisições excedido. Tente novamente mais tarde.',\n    })\n  }\n\n  // Erro global disparado se não houver advogado\n  if (error instanceof AxiosError) {\n    return reply.status(404).send({\n      message:\n        'Consulta indisponível ou advogado(a) não encontrado. Verifique os dados e tente novamente mais tarde.',\n    })\n  }\n\n  console.error(error)\n  // Enviar erro para alguma plataforma de observabilidade\n  return reply.status(500).send({\n    message: 'Erro interno do servidor. Tente novamente mais tarde.',\n  })\n}\n","export class BadRequestError extends Error {}\n","export class UnauthorizedError extends Error {\n  constructor(message?: string) {\n    super(message ?? ' Acesso não autorizado, tente novamente.')\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA2B;AAE3B,iBAAyB;;;ACFlB,IAAM,kBAAN,cAA8B,MAAM;AAAC;;;ACArC,IAAM,oBAAN,cAAgC,MAAM;AAAA,EAC3C,YAAY,SAAkB;AAC5B,UAAM,WAAW,6CAA0C;AAAA,EAC7D;AACF;;;AFIO,IAAM,eAAoC,CAAC,OAAO,SAAS,UAAU;AAC1E,MAAI,MAAM,YAAY;AACpB,WAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,MAC5B,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AAEA,MAAI,iBAAiB,qBAAU;AAC7B,WAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,MAC5B,SAAS;AAAA,MACT,QAAQ,MAAM,QAAQ,EAAE;AAAA,IAC1B,CAAC;AAAA,EACH;AAEA,MAAI,iBAAiB,iBAAiB;AACpC,WAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,MAC5B,SAAS,MAAM;AAAA,IACjB,CAAC;AAAA,EACH;AAEA,MAAI,iBAAiB,mBAAmB;AACtC,WAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,MAC5B,SAAS,MAAM;AAAA,IACjB,CAAC;AAAA,EACH;AAGA,MAAI,MAAM,eAAe,KAAK;AAC5B,WAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,MAC5B,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AAGA,MAAI,iBAAiB,yBAAY;AAC/B,WAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,MAC5B,SACE;AAAA,IACJ,CAAC;AAAA,EACH;AAEA,UAAQ,MAAM,KAAK;AAEnB,SAAO,MAAM,OAAO,GAAG,EAAE,KAAK;AAAA,IAC5B,SAAS;AAAA,EACX,CAAC;AACH;","names":[]}